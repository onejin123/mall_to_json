<!DOCTYPE html>
<html lang="ko">
<head>
  <title>Source de V√©rit√©</title>
  <link rel="icon" href="{{ url_for('static', filename='images/logo.png') }}" type="image/png">
  <meta charset="utf-8" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
  {% include 'navbar.html' %}

  <!-- üîÅ Ïä¨ÎùºÏù¥Îìú Ïù¥ÎØ∏ÏßÄ ÏòÅÏó≠ -->
  <a id="sliderLink" href="{{ url_for('product_bp.product_detail', product_id=36) }}">
    <img class="hero_header" id="heroSlider" src="{{ url_for('static', filename='images/onepiece.jpg') }}" alt="One Piece">
  </a>

  <script>
    const images = [
      {
        src: "{{ url_for('static', filename='images/onepiece.jpg') }}",
        link: "{{ url_for('product_bp.product_detail', product_id=36) }}"
      },
      {
        src: "{{ url_for('static', filename='images/shoe2.jpg') }}",
        link: "{{ url_for('product_bp.product_detail', product_id=34) }}"
      },
      {
        src: "{{ url_for('static', filename='images/supreme.jpg') }}",
        link: "{{ url_for('product_bp.product_detail', product_id=33) }}"
      }
    ];

    let currentIndex = 0;
    const slider = document.getElementById('heroSlider');
    const sliderLink = document.getElementById('sliderLink');

    setInterval(() => {
      currentIndex = (currentIndex + 1) % images.length;
      slider.src = images[currentIndex].src;
      sliderLink.href = images[currentIndex].link;
    }, 3000);
  </script>

  <!-- üéØ Ïã†ÏÉÅÌíà Ïä¨ÎùºÏù¥Îìú -->
  <h1 style="text-align:center;">Our new Products</h1>
  <div class="slider-container">
    <button class="prev-btn" disabled>&#10094;</button>
    <div class="products-slider" id="productsSlider">
      <!-- JS will inject product slides here -->
    </div>
    <button class="next-btn">&#10095;</button>
  </div>

  <script>
    const API_BASE = 'http://<BE_VM_IP>:8000';

    async function fetchProducts() {
      const res = await fetch(`${API_BASE}/api/products`);
      if (!res.ok) throw new Error('Failed to load products');
      return res.json();
    }

    function renderProducts(products) {
      const slider = document.getElementById('productsSlider');
      slider.innerHTML = '';
      products.forEach(prod => {
        const item = document.createElement('div');
        item.className = 'slide-item';
        item.innerHTML = `
          <a href="${API_BASE}/product/${prod.id}">
            <img src="static/${prod.image_path}" alt="${prod.name}" class="product-image">
            <p>${prod.name}</p>
            <p class="price">${prod.price}‚Ç©</p>
          </a>`;
        slider.appendChild(item);
      });
    }

    // Reuse existing slider controls
    const prevBtn = document.querySelector('.prev-btn');
    const nextBtn = document.querySelector('.next-btn');

    function updateSliderPosition() {
      const sliderWrapper = document.getElementById('productsSlider');
      const slideItems = sliderWrapper.querySelectorAll('.slide-item');
      const itemsPerView = 4;
      const totalItems = slideItems.length;
      const totalSlides = Math.ceil(totalItems / itemsPerView);
      let currentSlide = 0;

      function moveSlide(dir) {
        currentSlide = Math.min(Math.max(currentSlide + dir, 0), totalSlides - 1);
        const slideWidth = slideItems[0]?.offsetWidth || 0;
        sliderWrapper.style.transform = `translateX(-${currentSlide * slideWidth * itemsPerView}px)`;
        prevBtn.disabled = currentSlide === 0;
        nextBtn.disabled = currentSlide >= totalSlides - 1;
      }

      nextBtn.addEventListener('click', () => moveSlide(1));
      prevBtn.addEventListener('click', () => moveSlide(-1));
      moveSlide(0);
      window.addEventListener('resize', () => moveSlide(0));
    }

    window.addEventListener('DOMContentLoaded', async () => {
      try {
        const products = await fetchProducts();
        renderProducts(products);
        updateSliderPosition();
      } catch (e) {
        console.error(e);
      }
    });
  </script>

  {% include 'footer.html' %}
</body>
</html>
